# V0.4 — "Configurable"

## Purpose

buddy has a Settings UI. Users can manage models, fallbacks, and skills entirely from the browser — no manual file editing required.

## Capabilities

- **Application shell:** A collapsible sidebar with a dedicated navigation rail cleanly separates route switching from route-specific content. The sidebar collapses to an icon-only rail on desktop, preserving screen real estate while keeping primary navigation always accessible. This establishes the navigation surface that V0.5 extends for multi-interface management.
- **Settings page:** A new route in the Svelte app (`/settings`) with clearly separated sections.
- **Models section:** One sub-section per concern (Chat, Embedding — more added as needed in future versions). Each sub-section displays the ordered list of configured providers for that slot.
  - **Add/edit/delete** models within each section.
  - **Drag-and-drop vertical reordering** for fallback priority. The topmost model is the default; the rest are fallbacks tried in order.
  - **Connection test** on save — buddy pings the provider endpoint and reports success/failure inline.
- **Skills section:** View and configure enabled skills and their sandbox settings (allowed directories, allowed domains). Toggle skills on/off. Edit sandbox rules from the UI.
- **Safety and validation:**
  - Red/yellow indicators when a required model slot is empty or all providers in a slot are unreachable.
  - Inline validation on model configuration fields.
  - Warning persists in the chat UI when a concern has no model set (non-intrusive banner with a link to the relevant Settings section).
- **Graceful error messages:** Contextual, non-intrusive warnings throughout the chat UI when something is degraded. Examples:
  - *"An embedding model is required for long-term memory. This conversation will be cleared from memory once the page is closed. [Go to Settings > Models]()"*
  - *"Chat model unavailable. Trying fallback…"* / *"All chat models unavailable. Check Settings > Models."*
  - *"Skill 'read_file' has no allowed directories configured. [Go to Settings > Skills]()"*
- **Config persistence:** Settings changes are written back to `buddy.toml` via a backend API. The file remains the source of truth — the UI is a friendly editor for it. If `buddy.toml` grows unwieldy, consider a user-override layer at this point, but avoid premature splitting.

## Key Architectural Decisions

- **The sidebar is an application shell, not a conversation list.** The sidebar is structured as a navigation rail (route switching) with a context panel (route-specific content like the conversation list). This separation means adding a new top-level section — whether it's "Integrations" in V0.5 or "Agents" in V0.6 — is just another nav item, not a layout rearchitecture.
- **`buddy.toml` stays as the single config file.** The Settings UI reads and writes it through backend API endpoints. No separate database table for config — the TOML file is authoritative and human-readable for users who prefer a text editor.
- **Backend config API:** Endpoints for reading and writing each config section (models, skills, server). Validates before writing. Returns structured errors the frontend can display.
- **Skills stay in `buddy.toml`.** Until V0.6 introduces user-defined WASM skills with per-skill manifests, there's no need for a separate skills config. Built-in skills are few and simple.
- **Drag-and-drop** is implemented purely in the frontend (reorder a list, POST the new order). No complex backend state — the ordered array in the TOML file is the priority list.
- **No terminal CLI config commands yet.** For earlier versions, configuration is done in the UI (or by hand-editing the TOML). CLI config tooling arrives in V0.5 alongside `buddy-core` extraction, where a shared config library makes it natural.

## Intentionally Not Included

- No `buddy-core` extraction (V0.5)
- No Telegram/WhatsApp (V0.5)
- No multi-provider additions beyond what V0.3 ships with (V0.5 adds Ollama, Gemini, Mistral)
- No multi-agent or delegation (V0.6)
- No user-defined skills (V0.6)
- No terminal CLI config management (V0.5)

## Sets Up V0.5 By

The Settings UI establishes the user-facing configuration patterns that persist through all future versions. The application shell and navigation rail define the layout surface that V0.5 extends with interface management sections (Telegram, WhatsApp) and V0.6 with agent orchestration. When `buddy-core` is extracted in V0.5, the config management API becomes a shared library that the web UI, Telegram bot, and CLI all consume. The drag-and-drop model priority UI is reusable for agent model selection in V0.6.
